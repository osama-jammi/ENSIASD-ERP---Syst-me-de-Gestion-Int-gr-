<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extension de la vue hr.employee pour ajouter les champs ENSIASD -->
    <record id="view_hr_employee_form_ensiasd" model="ir.ui.view">
        <field name="name">hr.employee.form.ensiasd</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <page string="ENSIASD" name="ensiasd_info" groups="ensiasd_core.group_ensiasd_admin">
                    <group>
                        <group string="Informations Enseignant">
                            <field name="is_enseignant"/>
                            <field name="matricule_enseignant" invisible="not is_enseignant"/>
                            <field name="grade" invisible="not is_enseignant"/>
                            <field name="specialite" invisible="not is_enseignant"/>
                            <field name="date_recrutement" invisible="not is_enseignant"/>
                            <field name="bureau" invisible="not is_enseignant"/>
                        </group>
                        <group string="Affectations" invisible="not is_enseignant">
                            <field name="filiere_ids" widget="many2many_tags"/>
                        </group>
                    </group>
                    <notebook invisible="not is_enseignant">
                        <page string="Modules responsable">
                            <field name="module_ids">
                                <tree>
                                    <field name="code"/>
                                    <field name="name"/>
                                    <field name="filiere_id"/>
                                    <field name="semestre"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Éléments enseignés">
                            <field name="element_ids">
                                <tree>
                                    <field name="module_id"/>
                                    <field name="name"/>
                                    <field name="type_element"/>
                                    <field name="volume_horaire"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Filtre pour voir uniquement les enseignants -->
    <record id="view_hr_employee_search_ensiasd" model="ir.ui.view">
        <field name="name">hr.employee.search.ensiasd</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='my_team']" position="after">
                <separator/>
                <filter string="Enseignants" name="enseignants" domain="[('is_enseignant', '=', True)]"/>
            </xpath>
            <xpath expr="//field[@name='name']" position="before">
                <filter string="Grade" name="group_grade" context="{'group_by': 'grade'}"/>
                <filter string="Spécialité" name="group_specialite" context="{'group_by': 'specialite'}"/>
            </xpath>
        </field>
    </record>

    <!-- Vue Kanban pour les enseignants - SIMPLIFIÉE -->
    <record id="view_hr_employee_kanban_ensiasd" model="ir.ui.view">
        <field name="name">hr.employee.kanban.ensiasd</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.hr_kanban_view_employees"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="js_class">hr_employee_kanban</attribute>
            </xpath>
            <!-- SIMPLIFICATION : Utiliser des divs conditionnels -->
            <xpath expr="//div[hasclass('oe_kanban_details')]" position="inside">
                <div class="oe_kanban_bottom_left">
                    <div t-if="record.is_enseignant and record.is_enseignant === true">
                        <small><field name="grade"/></small><br/>
                        <small><field name="specialite"/></small>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <!-- Action pour voir les enseignants -->
    <record id="action_hr_employee_enseignants" model="ir.actions.act_window">
        <field name="name">Enseignants</field>
        <field name="res_model">hr.employee</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('is_enseignant', '=', True)]</field>
        <field name="context">{
            'default_is_enseignant': True,
            'search_default_enseignants': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Ajouter un nouvel enseignant
            </p>
            <p>
                Créez et gérez les profils des enseignants de l'ENSIASD.
            </p>
        </field>
    </record>
</odoo>