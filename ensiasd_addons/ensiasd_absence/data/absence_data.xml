<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Template email notification absence -->
        <record id="mail_template_absence_notification" model="mail.template">
            <field name="name">Notification d'absence</field>
            <field name="model_id" ref="model_ensiasd_absence"/>
            <field name="subject">Notification d'absence - {{ object.module_id.name }} - {{ object.date }}</field>
            <field name="email_from">{{ (object.env.company.email or 'noreply@ensiasd.ma') }}</field>
            <field name="email_to">{{ object.student_id.email }}</field>
            <field name="body_html"><![CDATA[
<div style="margin: 0px; padding: 0px; font-family: Arial, sans-serif;">
    <p>Cher(e) <strong>{{ object.student_id.name }}</strong>,</p>
    
    <p>Nous vous informons qu'une absence a √©t√© enregistr√©e √† votre nom :</p>
    
    <table style="border-collapse: collapse; margin: 20px 0; width: 100%;">
        <tr style="background-color: #f2f2f2;">
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Date</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ object.date }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Module</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ object.module_id.name }}</td>
        </tr>
        <tr style="background-color: #f2f2f2;">
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Type de s√©ance</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ object.type_seance }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Enseignant</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ object.enseignant_id.name if object.enseignant_id else '-' }}</td>
        </tr>
    </table>
    
    <p>Si vous souhaitez justifier cette absence, veuillez vous rendre √† l'administration 
    ou utiliser le lien suivant :</p>
    
    <p style="text-align: center; margin: 20px 0;">
        <a href="{{ object.env['ir.config_parameter'].sudo().get_param('web.base.url') }}/absence/justification/{{ object.id }}" 
           style="background-color: #875a7b; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
            Justifier mon absence
        </a>
    </p>
    
    <p style="color: #666; font-size: 12px;">
        Note : Les justifications doivent √™tre soumises dans un d√©lai de 48h.
    </p>
    
    <p>Cordialement,<br/>
    L'administration ENSIASD</p>
</div>
]]></field>
        </record>

        <!-- Template email formulaire d'appel -->
        <record id="mail_template_appel_seance" model="mail.template">
            <field name="name">Formulaire d'appel - S√©ance</field>
            <field name="model_id" ref="ensiasd_academic.model_ensiasd_seance"/>
            <field name="subject">Formulaire d'appel - {{ object.name }} - {{ object.date }}</field>
            <field name="email_from">{{ (object.env.company.email or 'noreply@ensiasd.ma') }}</field>
            <field name="email_to">{{ ctx.get('recipient_email') or (object.enseignant_id.work_email if object.enseignant_id else '') }}</field>
            <field name="body_html"><![CDATA[
<div style="margin: 0px; padding: 0px; font-family: Arial, sans-serif;">
    <p>Bonjour <strong>{{ object.enseignant_id.name if object.enseignant_id else 'Professeur' }}</strong>,</p>
    
    <p>Veuillez effectuer l'appel pour la s√©ance suivante :</p>
    
    <table style="border-collapse: collapse; margin: 20px 0; width: 100%;">
        <tr style="background-color: #875a7b; color: white;">
            <td colspan="2" style="padding: 10px; text-align: center;">
                <strong>{{ object.element_id.module_id.name }}</strong>
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Date</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ object.date }}</td>
        </tr>
        <tr style="background-color: #f2f2f2;">
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Horaire</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">
                {{ '%02d:%02d' % (int(object.heure_debut), int((object.heure_debut % 1) * 60)) }} - 
                {{ '%02d:%02d' % (int(object.heure_fin), int((object.heure_fin % 1) * 60)) }}
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Salle</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ object.salle_id.name }}</td>
        </tr>
        <tr style="background-color: #f2f2f2;">
            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Type</strong></td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ object.type_seance }}</td>
        </tr>
    </table>
    
    <p style="text-align: center; margin: 30px 0;">
        <a href="{{ object.env['ir.config_parameter'].sudo().get_param('web.base.url') }}/absence/appel/{{ ctx.get('token', '') }}" 
           style="background-color: #28a745; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; font-size: 16px;">
            üìã Faire l'appel en ligne
        </a>
    </p>
    
    <p style="color: #666; font-size: 12px;">
        Ce lien est valide pendant 48 heures. Si vous rencontrez des difficult√©s, 
        veuillez contacter l'administration.
    </p>
    
    <p>Cordialement,<br/>
    Le syst√®me de gestion ENSIASD</p>
</div>
]]></field>
        </record>

        <!-- Configuration par d√©faut -->
        <record id="config_auto_notify_student" model="ir.config_parameter">
            <field name="key">ensiasd_absence.auto_notify_student</field>
            <field name="value">True</field>
        </record>
    </data>
</odoo>
